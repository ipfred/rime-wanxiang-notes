# 功能亮点与配置速查（这才是万象的“爽点”）

这页基于 `README.md`（以及源项目文件）做“可操作”的浓缩版：告诉你 **怎么触发**、以及 **要改哪个文件** 才能生效。

> 配置生效位置的铁律：所有自定义优先写在 **用户目录根目录** 的 `wanxiang.custom.yaml` / `wanxiang_pro.custom.yaml`，不要在仓库 `custom/` 目录里直接改。

## 0) 先记住：功能通常分三层

- **触发方式**：按键 / 指令 / 前缀（例：`/sj`、`V3+5`、`` ` ``）
- **功能实现**：多在 `lua/`（例：`lua/shijian.lua`、`lua/super_calculator.lua`、`lua/super_tips.lua`）
- **配置入口**：多在 `wanxiang.schema.yaml`（定义默认值）+ 你的 `wanxiang.custom.yaml`（用 patch 改）

## 1) 指令切换输入类型（全拼/双拼）

**怎么用**

```
/pinyin  全拼
/flypy   小鹤双拼
/zrm     自然码
/mspy    微软双拼
/sogou   搜狗双拼
```

**为什么这么方便**

- 逻辑在：`lua/set_schema.lua`
- 它会把示例 `*.custom.yaml` 复制到你的用户目录根目录（若已存在则不覆盖），并把转写段落替换成目标方案
- 切换后需要“重新部署”（这是正常流程）

## 2) 「/ 引导模式」：符号、命令、快捷输入

**怎么用**

- `/sx` 等输入特殊符号（能输入什么，直接翻：`wanxiang_symbols.yaml`）
- `/wx` 查询仓库/版本（来自 Lua 扩展）

**怎么配置**

- 符号表：`wanxiang_symbols.yaml`
- `/` 的行为与引导设计不建议挪作他用（源方案对 `/` 的占用是“效率闭环”的一部分）

## 3) 日期 / 时间 / 农历 / 节气（超高频）

**怎么用（`/` 或 `o` 引导）**

- `/sj` 时间、`/rq` 日期、`/dt` 日期+时间、`/nl` 农历、`/jq` 节气、`/tt` 时间戳…
- `N0102`（月日）或 `N20250315`（年月日）

**怎么配置（自定义候选格式/顺序）**

- 默认定义在：`wanxiang.schema.yaml`（`date_formats` / `time_formats` / `datetime_formats`）
- 你可以在 `wanxiang.custom.yaml` 里 patch 覆盖，例如：

```yaml
patch:
  date_formats:
    - "Y-m-d"
    - "Y年m月d日"
  time_formats:
    - "H:M"
    - "H:M:S"
  datetime_formats:
    - "Y-m-d H:M:S"
```

## 4) 计算器模式（V 前缀）

**怎么用**

- `V3+5` → `8`
- 支持 `+ - * / % ^`、以及 `sin()` `cos()` 等（更多见：`lua/super_calculator.lua`）

**怎么配置**

- 触发前缀：`wanxiang.schema.yaml` 的 `calculator/trigger: "V"`
- 识别规则：`wanxiang.schema.yaml` 的 `recognizer/patterns/calculator: "^V.*$"`

## 5) 超级 Tips 提示（表情/化学式/翻译/符号…）

**怎么用**

- `Ctrl+t` 开关 Tips（定义在：`wanxiang.schema.yaml` 的 `key_binder/bindings`）
- 默认上屏按键是 `,`（逗号）

**怎么配置**

- 上屏按键：在你的 `wanxiang.custom.yaml` 改 `key_binder/tips_key`

```yaml
patch:
  key_binder/tips_key: "comma"  # 或 "period" 等
```

- 映射数据：
  - 内置规则：`lua/tips/tips_show.txt`
  - 个人规则（推荐新建）：`lua/tips/tips_user.txt`

## 6) 输入码显示音调 / 候选注释增强

**怎么用**

- `Ctrl+s`：输入码显示音调（`tone_display`）
- `Ctrl+a`：候选注释开关（`tone_hint`）

它们都在 `wanxiang.schema.yaml` 的 `key_binder/bindings` 里定义。

**怎么配置**

- 相关开关定义在：`wanxiang.schema.yaml` 的 `switches`
- 进阶注释/预编辑逻辑主要在：`lua/super_comment_preedit.lua`

## 7) 手动排序（把“你想要的候选”固定下来）

**怎么用**

- `Ctrl+j` 左移、`Ctrl+k` 右移、`Ctrl+l` 重置、`Ctrl+p` 置顶

**怎么配置**

- 快捷键配置入口（你可以改键）：你的 `wanxiang.custom.yaml` 里可以写 `key_binder/sequence`（源方案样例通常也会提供这一段）
- 实现与数据：`lua/super_sequence.lua`、`lua/sequence.userdb`

## 8) 候选切割机（先上屏前 N 个字）

**怎么用**

- `Ctrl+1` ～ `Ctrl+0`：把当前首选候选的前 N 个字先上屏（适合“前半句对了，后半句还没对”）

**在哪里看实现**

- `lua/partial_commit.lua`

## 9) 以词定字（用整句打字，但只取某一个字）

**怎么用**

- `[` 上屏当前词的第一个字
- `]` 上屏当前词的最后一个字

**怎么配置**

- 键位定义（可换键）：`wanxiang.schema.yaml` 的 `key_binder/select_first_character`、`key_binder/select_last_character`
- 实现：`lua/select_character.lua`

## 10) 字符集过滤（小字集 / 大字集）

**怎么用**

- `Ctrl+g` 切换 `charset_filter`

**怎么配置**

- 黑白名单入口：`wanxiang.schema.yaml` 的 `charsetlist` / `charsetblacklist`
- 过滤实现：`lua/super_filter.lua`

## 11) 混合编码（中英混输、金额大写、Unicode…）

**怎么用（无需引导，直接打）**

- `AD钙奶`、`Type-C`、`PN结`
- `R1234`（金额大写）
- `U62fc` → 拼

**它在哪里**

- 方案与词库：`wanxiang_mixedcode.schema.yaml`、`wanxiang_mixedcode.dict.yaml`
- 标准版 schema 默认依赖并挂载：`wanxiang.schema.yaml`（dependencies + translator）

## 12) 两个“默认没开，但很有用”的开关

### 自动上屏（唯一候选时直接上屏）

在 `wanxiang.schema.yaml` 的 `speller:` 里有现成注释：

- `auto_select: true`
- `auto_select_pattern: ...`

建议你先用 patch 小范围启用，再根据自己编码习惯调整正则。

### 数字后自动半角分隔（逗号/句号）

`wanxiang.schema.yaml`：

- `punctuator/digit_separators: ",."`

如果你完全不需要这个体验，可以 patch 成 `commit`（把它当作“确认上屏”）：

```yaml
patch:
  punctuator/digit_separators: commit
```

## 想看更完整的“整理稿”

- 参考：`README.md`
